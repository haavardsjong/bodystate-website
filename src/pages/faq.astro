---
import BaseLayout from '../layouts/BaseLayout.astro';
import { createTranslationHelper } from '../i18n/enhanced-utils.js';

// Accept lang as a prop, default to 'en' for base route
const { lang = 'en' } = Astro.props;
const { t } = createTranslationHelper(lang);

const pageTitle = t('pages.faq.pageTitle');
---
<BaseLayout title={pageTitle}>
	<div class="faq-container">
		<h1>{t('pages.faq.heading')}</h1>

		<section class="faq-section">
			<h2>{t('pages.faq.sections.userGuide.title')}</h2>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.userGuide.questions.whatIsBodyState.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.userGuide.questions.whatIsBodyState.answer.p1')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.whatIsBodyState.answer.p2')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.whatIsBodyState.answer.p3')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.whatIsBodyState.answer.p4')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.whatIsBodyState.answer.p5')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.userGuide.questions.howDoesScoreWork.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.userGuide.questions.howDoesScoreWork.answer.p1')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.howDoesScoreWork.answer.p2')}</p>
					<ul>
						{Array.isArray(t('pages.faq.sections.userGuide.questions.howDoesScoreWork.answer.list')) && 
						 t('pages.faq.sections.userGuide.questions.howDoesScoreWork.answer.list').map((item) => (
							<li>{item}</li>
						))}
					</ul>
					<p>{t('pages.faq.sections.userGuide.questions.howDoesScoreWork.answer.p3')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.howDoesScoreWork.answer.p4')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.p1')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.p2')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.p3')}</p>
					<h4>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.h4')}</h4>
					<p>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.p4')}</p>
					<p>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.p5')}</p>
					<ol>
						{Array.isArray(t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.steps')) && 
						 t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.steps').map((step) => (
							<li set:html={step}></li>
						))}
					</ol>
					<p>{t('pages.faq.sections.userGuide.questions.whatAreBaselines.answer.p6')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.userGuide.questions.aboutSleep.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.userGuide.questions.aboutSleep.answer.p1')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.userGuide.questions.aboutFatigue.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.userGuide.questions.aboutFatigue.answer.p1')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.userGuide.questions.aboutHRV.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.userGuide.questions.aboutHRV.answer.p1')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.userGuide.questions.aboutHR.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.userGuide.questions.aboutHR.answer.p1')}</p>
				</div>
			</details>
		</section>

		<section class="faq-section">
			<h2>{t('pages.faq.sections.general.title')}</h2>
			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.general.questions.noDataAfterInstall.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.general.questions.noDataAfterInstall.answer.p1')}</p>
					<ol>
						{Array.isArray(t('pages.faq.sections.general.questions.noDataAfterInstall.answer.steps')) && 
						 t('pages.faq.sections.general.questions.noDataAfterInstall.answer.steps').map((step) => (
							<li>{step}</li>
						))}
					</ol>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.general.questions.increaseAccuracy.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.general.questions.increaseAccuracy.answer.p1')}</p>
					<p>{t('pages.faq.sections.general.questions.increaseAccuracy.answer.p2')}</p>
					<ol>
						{Array.isArray(t('pages.faq.sections.general.questions.increaseAccuracy.answer.steps')) && 
						 t('pages.faq.sections.general.questions.increaseAccuracy.answer.steps').map((step) => (
							<li>{step}</li>
						))}
					</ol>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.general.questions.issuesAfterReinstall.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.general.questions.issuesAfterReinstall.answer.p1')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.general.questions.whyDataDiffers.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.general.questions.whyDataDiffers.answer.p1')}</p>
					<p>{t('pages.faq.sections.general.questions.whyDataDiffers.answer.p2')}</p>
					<p>{t('pages.faq.sections.general.questions.whyDataDiffers.answer.p3')}</p>
				</div>
			</details>
			
			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.general.questions.widgetNotUpdating.question')}</h3>
				</summary>
				<div class="faq-content">
					<p set:html={t('pages.faq.sections.general.questions.widgetNotUpdating.answer.p1')}></p>
					<ol>
						{Array.isArray(t('pages.faq.sections.general.questions.widgetNotUpdating.answer.reasons')) && 
						 t('pages.faq.sections.general.questions.widgetNotUpdating.answer.reasons').map((reason) => (
							<li set:html={reason}></li>
						))}
					</ol>
					<p>{t('pages.faq.sections.general.questions.widgetNotUpdating.answer.p2')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.general.questions.watchAppNotSyncing.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.general.questions.watchAppNotSyncing.answer.p1')}</p>
					<p>{t('pages.faq.sections.general.questions.watchAppNotSyncing.answer.p2')}</p>
					<p>{t('pages.faq.sections.general.questions.watchAppNotSyncing.answer.p3')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary>
					<h3>{t('pages.faq.sections.general.questions.watchComplicationsOutOfSync.question')}</h3>
				</summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.general.questions.watchComplicationsOutOfSync.answer.p1')}</p>
				</div>
			</details>
		</section>

		<section class="faq-section">
			<h2>{t('pages.faq.sections.sleepTracking.title')}</h2>
			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.question')}</h3></summary>
				<div class="faq-content">
					<p set:html={t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.p1')}></p>
					<h4>{t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.h4_1')}</h4>
					<ol>
						{Array.isArray(t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps1')) && 
						 t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps1').map((step) => (
							<li>{step}</li>
						))}
					</ol>
					<h4>{t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.h4_2')}</h4>
					<ol>
						{Array.isArray(t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps2')) && 
						 t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps2').map((step) => (
							<li>{step}</li>
						))}
					</ol>
					<h4>{t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.h4_3')}</h4>
					<ol>
						{Array.isArray(t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps3')) && 
						 t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps3').map((step) => (
							<li>{step}</li>
						))}
					</ol>
					<h4>{t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.h4_4')}</h4>
					<ol>
						{Array.isArray(t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps4')) && 
						 t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.steps4').map((step) => (
							<li>{step}</li>
						))}
					</ol>
					<h4>{t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.h4_5')}</h4>
					<ul>
						{Array.isArray(t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.considerations')) && 
						 t('pages.faq.sections.sleepTracking.questions.howToTrackSleep.answer.considerations').map((item) => (
							<li set:html={item}></li>
						))}
					</ul>
				</div>
			</details>

			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.question')}</h3></summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.p1')}</p>
					<h4>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.h4_1')}</h4>
					<ul>
						<li>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.check')}</li>
					</ul>
					<h4>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.h4_2')}</h4>
					<ul>
						<li>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.speedUp')}</li>
					</ul>
					<h4>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.h4_3')}</h4>
					<ul>
						<li set:html={t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.general')}></li>
					</ul>
					<h4>{t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.h4_4')}</h4>
					<ul>
						{Array.isArray(t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.troubleshooting')) && 
						 t('pages.faq.sections.sleepTracking.questions.sleepDataNotAppearing.answer.troubleshooting').map((item) => (
							<li set:html={item}></li>
						))}
					</ul>
				</div>
			</details>

			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.sleepTracking.questions.selectAnotherSleepSource.question')}</h3></summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.sleepTracking.questions.selectAnotherSleepSource.answer.p1')}</p>
					<p>{t('pages.faq.sections.sleepTracking.questions.selectAnotherSleepSource.answer.p2')}</p>
					<p>{t('pages.faq.sections.sleepTracking.questions.selectAnotherSleepSource.answer.p3')}</p>
					<p>{t('pages.faq.sections.sleepTracking.questions.selectAnotherSleepSource.answer.p4')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.sleepTracking.questions.trackWithOtherDevices.question')}</h3></summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.sleepTracking.questions.trackWithOtherDevices.answer.p1')}</p>
					<p>{t('pages.faq.sections.sleepTracking.questions.trackWithOtherDevices.answer.p2')}</p>
					<p>{t('pages.faq.sections.sleepTracking.questions.trackWithOtherDevices.answer.p3')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.sleepTracking.questions.doNapsImprove.question')}</h3></summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.sleepTracking.questions.doNapsImprove.answer.p1')}</p>
				</div>
			</details>
		</section>

		<section class="faq-section">
			<h2>{t('pages.faq.sections.healthAccess.title')}</h2>
			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.healthAccess.questions.howToEnableHealthAccess.question')}</h3></summary>
				<div class="faq-content">
					<ol>
						{Array.isArray(t('pages.faq.sections.healthAccess.questions.howToEnableHealthAccess.answer.steps')) && 
						 t('pages.faq.sections.healthAccess.questions.howToEnableHealthAccess.answer.steps').map((step) => (
							<li>{step}</li>
						))}
					</ol>
				</div>
			</details>

			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.healthAccess.questions.healthAccessError.question')}</h3></summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.healthAccess.questions.healthAccessError.answer.p1')}</p>
					<ol>
						{Array.isArray(t('pages.faq.sections.healthAccess.questions.healthAccessError.answer.steps')) && 
						 t('pages.faq.sections.healthAccess.questions.healthAccessError.answer.steps').map((step) => (
							<li>{step}</li>
						))}
					</ol>
				</div>
			</details>

			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.healthAccess.questions.blankScreenInSettings.question')}</h3></summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.healthAccess.questions.blankScreenInSettings.answer.p1')}</p>
				</div>
			</details>

			<details class="faq-item">
				<summary><h3>{t('pages.faq.sections.healthAccess.questions.whatIsHealthAccess.question')}</h3></summary>
				<div class="faq-content">
					<p>{t('pages.faq.sections.healthAccess.questions.whatIsHealthAccess.answer.p1')}</p>
					<p>{t('pages.faq.sections.healthAccess.questions.whatIsHealthAccess.answer.p2')}</p>
					<p>{t('pages.faq.sections.healthAccess.questions.whatIsHealthAccess.answer.p3')}</p>
					<p>{t('pages.faq.sections.healthAccess.questions.whatIsHealthAccess.answer.p4')}</p>
				</div>
			</details>
		</section>
	</div>
</BaseLayout>

<style>
	.faq-container {
		max-width: 800px;
		margin: 0 auto var(--space-xl) auto;
		padding: var(--space-lg);
	}

	.faq-container h1 {
		text-align: center;
		margin-bottom: var(--space-xl);
		font-size: 2.8rem;
	}

	.faq-section h2 {
		font-size: 2rem;
		margin-top: var(--space-xl);
		margin-bottom: var(--space-lg);
		padding-bottom: var(--space-sm);
		border-bottom: 1px solid white;
		color: var(--text-primary);
	}

	.faq-item {
		/* border-bottom: 1px solid var(--glass-border); REMOVED - will be on summary top */
	}

	.faq-item summary {
		list-style: none; /* Remove default marker */
		cursor: pointer;
		padding: var(--space-md) 0;
		display: flex;
		justify-content: space-between;
		align-items: center;
		border-top: 1px solid white;
	}

	.faq-item:first-of-type summary {
		border-top: none; /* Remove top border for the very first item in a section if h2 has bottom border */
		/* OR, we rely on the h2's border-bottom and remove this rule, if spacing is right */
	}

	.faq-item summary::-webkit-details-marker {
		display: none;
	}

	.faq-item summary h3 {
		font-size: 1.1rem;
		margin: 0;
		color: var(--text-primary);
		font-weight: 400;
	}
	
	.faq-item summary::after {
		content: '+';
		font-size: 1.8rem;
		color: var(--text-secondary);
		transition: transform 0.2s ease-out;
		font-weight: 300;
	}

	.faq-item[open] summary::after {
		content: 'âˆ’';
		transform: rotate(180deg);
	}

	.faq-item .faq-content {
		padding: var(--space-sm) 0 var(--space-md) 0;
	}

	.faq-item .faq-content h4 {
		font-size: 1.2rem;
		margin-top: var(--space-md);
		margin-bottom: var(--space-sm);
		color: var(--text-secondary);
	}

	.faq-item .faq-content p,
	.faq-item .faq-content ul,
	.faq-item .faq-content ol {
		margin-bottom: var(--space-md);
		line-height: 1.7;
		color: var(--text-secondary);
	}

	.faq-item .faq-content ul, 
	.faq-item .faq-content ol {
		padding-left: var(--space-lg);
	}

	.faq-item .faq-content li {
		margin-bottom: var(--space-xs);
	}

	.faq-item .faq-content strong {
		color: var(--text-primary);
		font-weight: 500;
	}
</style> 